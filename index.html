<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>DIA CONN Events</title>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet"/>

<style>
body{
margin:0;
font-family:system-ui;
background:#f5f6fb;
padding:20px;
color:#2563eb;
}

.wrapper{
max-width:1300px;
margin:auto;
background:white;
border-radius:24px;
padding:20px;
box-shadow:0 20px 40px #0002;
}

.toolbar{
display:flex;
gap:10px;
flex-wrap:wrap;
margin-bottom:10px;
}

select,button{
padding:6px 12px;
border-radius:10px;
border:1px solid #ccc;
background:white;
cursor:pointer;
color:#2563eb;
}

.cards{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
gap:12px;
margin-top:12px;
}

.card{
padding:12px;
border-radius:14px;
color:#2563eb;
box-shadow:0 6px 14px #0002;
}

.blue{background:linear-gradient(135deg,#dbeafe,#93c5fd)}
.pink{background:linear-gradient(135deg,#fbcfe8,#f9a8d4)}
.green{background:linear-gradient(135deg,#dcfce7,#86efac)}
.yellow{background:linear-gradient(135deg,#fef9c3,#fde047)}

.title{font-weight:700}
.meta{font-size:13px}

iframe{
width:100%;
height:450px;
border:0;
margin-top:20px;
border-radius:18px;
}

#calendar{margin-top:20px}
</style>
</head>

<body>

<div class="wrapper">

<h2>DIA : CONN Activities</h2>

<div class="toolbar">
<button id="prev">← Prev</button>
<button id="next">Next →</button>

<select id="range">
<option value="day">Day</option>
<option value="week">Week</option>
<option value="month" selected>Month</option>
<option value="year">Year</option>
<option value="all">Schedule</option>
</select>

<select id="view">
<option value="calendar">Calendar</option>
<option value="list">List</option>
<option value="both" selected>Both</option>
</select>
</div>

<div id="cards" class="cards"></div>

<div id="calendar"></div>

<iframe id="gcal"></iframe>

</div>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

<script>
const CAL_ID="parknahpus.bitnix@gmail.com";
const API_KEY="AIzaSyDO5Iqc2-P814zb7Zrg08F1T-qLKVOapbY";

let cursor=new Date();
let fc;

function category(t){
 if(t.includes("Meeting with G2E")) return "blue";
 if(t.includes("Chulalongkorn Hospital")) return "pink";
 if(t.includes("Bangkok Hospital")) return "green";
 if(t.includes("Set up booth")) return "yellow";
 return "blue";
}

function getRange(type){
 const s=new Date(cursor),e=new Date(cursor);
 if(type==="day"){}
 else if(type==="week"){s.setDate(s.getDate()-s.getDay());e.setDate(s.getDate()+6);}
 else if(type==="month"){s.setDate(1);e.setMonth(s.getMonth()+1);e.setDate(0);}
 else if(type==="year"){s.setMonth(0,1);e.setMonth(11,31);}
 else{s.setFullYear(1970);e.setFullYear(3000);}
 return{start:s,end:e};
}

async function load(){
 const r=getRange(range.value);
 const u=new URL(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(CAL_ID)}/events`);
 u.searchParams.set("key",API_KEY);
 u.searchParams.set("singleEvents","true");
 u.searchParams.set("orderBy","startTime");
 u.searchParams.set("timeMin",r.start.toISOString());
 u.searchParams.set("timeMax",r.end.toISOString());

 const d=await fetch(u).then(x=>x.json());
 const ev=(d.items||[]).map(e=>({
   title:e.summary,
   start:e.start.dateTime||e.start.date,
   end:e.end.dateTime||e.end.date
 }));

 renderCards(ev);
 renderCalendar(ev);
 renderIframe();
}

function renderCards(ev){
 cards.innerHTML="";
 if(view.value==="calendar") return;

 ev.forEach(e=>{
   const c=document.createElement("div");
   c.className="card "+category(e.title);
   c.innerHTML=`<div class="title">${e.title}</div>
                <div class="meta">${new Date(e.start).toLocaleString()}</div>`;
   cards.appendChild(c);
 });
}

function renderCalendar(ev){
 if(view.value==="list") return;

 if(!fc){
   fc=new FullCalendar.Calendar(calendar,{
     initialView:"dayGridMonth",
     headerToolbar:false,
     events:ev
   });
   fc.render();
 }else{
   fc.removeAllEvents();
   ev.forEach(x=>fc.addEvent(x));
 }
}

function renderIframe(){
 const d1=`${cursor.getFullYear()}${String(cursor.getMonth()+1).padStart(2,"0")}01`;
 const d2=`${cursor.getFullYear()}${String(cursor.getMonth()+2).padStart(2,"0")}01`;
 gcal.src=`https://calendar.google.com/calendar/embed?src=${CAL_ID}&ctz=Asia/Bangkok&mode=MONTH&hl=en&dates=${d1}/${d2}`;
}

prev.onclick=()=>{cursor.setMonth(cursor.getMonth()-1);load();}
next.onclick=()=>{cursor.setMonth(cursor.getMonth()+1);load();}
range.onchange=load;
view.onchange=load;

load();
</script>

</body>
</html>
